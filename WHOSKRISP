-- [[ MIRROR HUB V7 - FULL SCREEN INVISIBLE FLOW ]] --
-- Logic: Invisible Full-Screen Capture | 3-hit Burst | 50 HPS | Auto-Target Nearest

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- // UI PROTECTION
local ProtectUI = gethui or function() return LocalPlayer:WaitForChild("PlayerGui") end
local ScreenGui = Instance.new("ScreenGui", ProtectUI())
ScreenGui.Name = "Mirror_Invisible_Mobile"
ScreenGui.ResetOnSpawn = false

local Settings = {
    Aura = { 
        Enabled = true, 
        Range = 15, -- Increased range slightly for better mobile feel
        IsClicking = false,
        LastHit = 0,
        HPS = 25, -- Defaulting to a high speed
        BurstPower = 3
    },
    Speed = { Enabled = false, Value = 16 }
}

-- // REMOTE LOCATOR
local HitRemote
pcall(function()
    HitRemote = game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("CombatService"):WaitForChild("RF"):WaitForChild("Hit")
end)

-- // NEW TARGETING: CLOSEST PLAYER (No Circle Needed)
local function GetClosestTarget()
    local closestChar, shortestDist = nil, Settings.Aura.Range
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            local hrp = p.Character:FindFirstChild("HumanoidRootPart")
            local hum = p.Character:FindFirstChildOfClass("Humanoid")
            local myHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            
            if hrp and hum and hum.Health > 0 and myHRP then
                local dist = (hrp.Position - myHRP.Position).Magnitude
                if dist < shortestDist then 
                    shortestDist = dist 
                    closestChar = p.Character 
                end
            end
        end
    end
    return closestChar
end

-- // INVISIBLE FULL-SCREEN INPUT CAPTURE
local TouchCapture = Instance.new("TextButton", ScreenGui)
TouchCapture.Size = UDim2.new(1, 0, 1, 0) -- Covers 100% of the screen
TouchCapture.BackgroundTransparency = 1 -- COMPLETELY INVISIBLE
TouchCapture.Text = ""
TouchCapture.ZIndex = -1 -- Stays behind your other UI buttons

-- Detection Logic
TouchCapture.MouseButton1Down:Connect(function() Settings.Aura.IsClicking = true end)
TouchCapture.MouseButton1Up:Connect(function() Settings.Aura.IsClicking = false end)

-- // MOBILE TOGGLE BUTTONS (DRAGGABLE)
local function CreateToggleButton(name, pos, color, text)
    local btn = Instance.new("TextButton", ScreenGui)
    btn.Size = UDim2.new(0, 50, 0, 50)
    btn.Position = pos
    btn.BackgroundColor3 = color
    btn.Text = text
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    btn.Draggable = true 
    btn.Active = true
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0.5, 0)
    return btn
end

local ToggleUIBtn = CreateToggleButton("UI", UDim2.new(0.1, 0, 0.2, 0), Color3.fromRGB(40, 40, 40), "UI")
local ToggleAuraBtn = CreateToggleButton("AURA", UDim2.new(0.1, 0, 0.3, 0), Color3.fromRGB(0, 200, 100), "ATK")

-- // ENGINE
RunService.Heartbeat:Connect(function()
    if not Settings.Aura.Enabled then return end

    -- Speed Hack
    if Settings.Speed.Enabled and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed = Settings.Speed.Value end
    end

    -- Combat Loop
    if Settings.Aura.IsClicking then
        local currentTime = tick()
        if currentTime - Settings.Aura.LastHit >= (0.7 / Settings.Aura.HPS) then
            local target = GetClosestTarget()
            if target then
                local hum = target:FindFirstChildOfClass("Humanoid")
                local hrp = target:FindFirstChild("HumanoidRootPart")
                Settings.Aura.LastHit = currentTime
                
                task.spawn(function()
                    for i = 1, Settings.Aura.BurstPower do
                        pcall(function() HitRemote:InvokeServer(hum, hrp.Position) end)
                    end
                end)
            end
        end
    end
end)

-- // MAIN MENU (STAYS THE SAME FOR SETTINGS)
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 200, 0, 180)
Main.Position = UDim2.new(0.5, -100, 0.5, -90)
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
Main.Draggable = true
Main.Active = true
Instance.new("UICorner", Main)

local Title = Instance.new("TextLabel", Main, {Size = UDim2.new(1,0,0,30), Text = "MIRROR MOBILE", BackgroundTransparency = 1, TextColor3 = Color3.new(1,1,1)})
Title.Font = Enum.Font.GothamBold

-- Toggle Combat UI
ToggleUIBtn.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)
ToggleAuraBtn.MouseButton1Click:Connect(function() 
    Settings.Aura.Enabled = not Settings.Aura.Enabled
    ToggleAuraBtn.BackgroundColor3 = Settings.Aura.Enabled and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(200, 50, 50)
end)

-- (Slider and Speed Logic code remains the same as previous)
